<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<!--
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<link rel="stylesheet" href="bootstrap/dist/css/bootstrap.min.css" />
<script src="bootstrap/dist/js/bootstrap.min.js"></script>

<style>
* {box-sizing: border-box}


body {font-family: "Lato", sans-serif;
  /*  background-color: #e2e2e2; */
	}

.monoselect {
    font-family: monospace,monospace;
}


/* Style the tab */
.tab {
  float: left;
  border: 1px solid #ccc;
  background-color: #f1f1f1;
  width: 10%;
  height: 600px;

    
}

/* Style the buttons inside the tab */
.tab button {
  display: block;
  background-color: inherit;
  color: black;
  padding: 22px 16px;
  width: 100%;
  border: none;
  outline: none;
  text-align: left;
  cursor: pointer;
  transition: 0.3s;
  font-size: 17px;
}

/* Change background color of buttons on hover */
.tab button:hover {
  background-color: #ddd;
}

/* Create an active/current "tab button" class */
.tab button.active {
  background-color: #ccc;
}

/* Style the tab content */
.tabcontent {
  float: left;
  padding: 12px 12px;
  border: 1px solid #ccc;
  width: 90%;
  border-left: none;
  height: 600px;
  /*background-color:rgb(99, 96, 99);*/
}

header {

  border: transparent 1px solid;
	background: #1e5799; /* Old browsers */
  background: -moz-linear-gradient(top,  #1e5799 0%, #207cca 30%, #2989d8 50%, #7db9e8 100%); /* FF3.6+ */
  background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#1e5799), color-stop(30%,#207cca), color-stop(50%,#2989d8), color-stop(100%,#7db9e8)); /* Chrome,Safari4+ */
  background: -webkit-linear-gradient(top,  #384049 0%,#207cca 30%,#2989d8 50%,#7db9e8 100%); /* Chrome10+,Safari5.1+ */
  background: -o-linear-gradient(top,  #1e5799 0%,#207cca 30%,#2989d8 50%,#7db9e8 100%); /* Opera 11.10+ */
  background: -ms-linear-gradient(top,  #1e5799 0%,#207cca 30%,#2989d8 50%,#7db9e8 100%); /* IE10+ */
  background: linear-gradient(to bottom,  #1e5799 0%,#207cca 30%,#2989d8 50%,#7db9e8 100%); /* W3C */
  filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#1e5799', endColorstr='#7db9e8',GradientType=0 ); /* IE6-9 */
}
</style>
</head>
<body>
	<header>
		<p class="site-title"><IMG alt="Contact Us"  style="height:100px" src="images/logo.png"></p>
		<p>Family Budge Planner - Charting, Forecasting examples discussions</p>
  </header>
  
	<div id="body">
		<div class="tab">
		<button class="tablinks" onclick="openTab(event, 'Home')" id="defaultOpen">Home</button>
		<button class="tablinks" onclick="openTab(event, 'Product')">Product</button>
		<button class="tablinks" onclick="openTab(event, 'Category')">Category</button>
		<button class="tablinks" onclick="openTab(event, 'CategoryProduct')">Product Category</button>
		</div>

		<div id="Home" class="tabcontent">
      <div class="container-fluid"> 
        <div class="row" > 
          <div class="col-sm-4">
              <span style="font-size: 22px;">Home</span> 
              <span style="font-size: 16px;">- Manage Purchases</span> 
          </div>
        </div>
      </div>
    

        <div style="background-color: yellow;"  class="container-fluid"> 
            <div class="row"> 
                <div class="col-sm-3 offset-sm-1"><label class='monoselect'>Title........Count.........Cost</label></div> 
            </div>
            <div class="row"> 
                <div class="col-sm-1"><label class="label" >Product</label></div> 
                <div class="col-sm-3"><SELECT class='monoselect' id='selHomeProducts' name='selProcuts' ></SELECT></div> 
            </div>
            <div class="row"> 
              <div class="col-sm-1"><label class="label" ># Bought</label></div> 
              <div class="col-sm-2"><input id='txtHomeCount' type="text" class="form-control" /></div>
          </div>  
          <div class="row"> 
            <div class="col-sm-1"><label class="label" >Date of Purchase</label></div> 
            <div class="col-sm-2"><input id='txtHomeDate' type="date" class="form-control" /></div>
        </div>  
        <div class="row"> 
          <div class="col-sm-2"></div> 
      </div>  
      <div class="row"> 
                <div class="col-sm-12 offset-sm-2"><INPUT id='btnHomeAdd' type=button value='Add Purchase' /></div> 
            </div>  
        </div>

        <table id="tblPurchaseData2" class="table table-responsive table-striped table-hover table-condensed">
          <tr  style="background-color: orangered;">
              <th>Title</th>
              <th>Unit Count</th>
              <th>Unit Cost</th>
              <th>Count</th>
              <th>Cost</th>
              <th>Date</th>
            </tr>
        </table>
  

        <div  style="background-color: orangered;"  class="container-fluid"> 
            <div class="row"> 
                <div class="col-sm-12 offset-sm-2">Maintain Purchases</div> 
            </div>  
            <div class="row"> 
                <div class="col-sm-2">Title</div> 
                <div class="col-sm-2">Unit Count</div> 
                <div class="col-sm-2">Unit Cost</div> 
                <div class="col-sm-2">Count</div> 
                <div class="col-sm-2">Cost</div> 
            </div>
        </div>
        <div id="tblPurchaseData" style="background-color: white;"  class="container-fluid"> 
         </div>

  	</div>

		<div id="Product" class="tabcontent">
        <div class="container-fluid"> 
            <div class="row" > 
              <div class="col-sm-4">
                  <span style="font-size: 22px;">Product</span> 
                  <span style="font-size: 16px;">- Manage Products</span> 
              </div>
            </div>
          </div>
        
        <div  style="background-color: lightgreen;"  class="container-fluid"> 
            <div class="row"> 
                <div class="col-sm-2">Title</div> 
                <div class="col-sm-2"><INPUT id='txtAddTitle' name='txtAddTitle' /></div> 
            </div>
            <div class="row"> 
                <div class="col-sm-2">Count</div> 
                <div class="col-sm-2"><INPUT id='txtAddCount' name='txtAddCount' /></div> 
            </div>
            <div class="row"> 
                <div class="col-sm-2">Cost</div> 
                <div class="col-sm-2"><INPUT id='txtAddCost' name='txtAddCost' /></div> 
            </div>
            <div class="row"> 
                <div class="col-sm-3"><INPUT id='btnAddProduct' type=button value='Add' /></div> 
            </div>
        </div>
        <div  style="background-color: orangered;"  class="container-fluid"> 
            <div class="row"> 
                <div class="col-sm-12 offset-sm-3">Maintain Products</div> 
            </div>  
            <div class="row"> 
                <div class="col-sm-2">ID</div> 
                <div class="col-sm-2">Title</div> 
                <div class="col-sm-2">Count</div> 
                <div class="col-sm-2">Cost</div> 
            </div>
        </div>
        <div id="tblProductData" style="background-color: white"  class="container-fluid"> 
        </div>            
        <div  style="background-color: orangered;"  class="container-fluid"> 
            <div class="row"> 
            <div class="col-sm-3"><INPUT id='btnRemoveProduct' type=button value='Del' /></div> 
          </div>
        </div>
</div>

<div id="Category" class="tabcontent">
  <div class="container-fluid"> 
    <div class="row" > 
      <div class="col-sm-4">
          <span style="font-size: 22px;">Category</span> 
          <span style="font-size: 16px;">- Manage Product Categories</span> 
      </div>
    </div>
  </div>
  <div  style="background-color: lightgreen;"  class="container-fluid"> 
        <div class="row"> 
            <div class="col-sm-1">Title</div> 
            <div class="col-sm-2"><INPUT id='txtAddCategoryTitle' /></div> 
        </div>
        <div class="row"> 
            <div class="col-sm-1"><button class="btn btn-primary" id='btnAddCategory' >Add</button></div> 
            <div class="col-sm-1"><button class="btn btn-primary" disabled id='btnDelCategory' >Del</button></div> 
            <div class="col-sm-1"><button class="btn btn-primary" disabled id='btnUpdateCategory' >Update</button></div> 
        </div>
  </div>
  <table id="tblCategoryData" class="table table-responsive table-striped table-hover table-condensed">
      <tr  style="background-color: orangered;">
          <th>ID</th>
          <th>Title</th>
        </tr>
    </table>

  </div>            

</div>
<div id="CategoryProduct" class="tabcontent">
    <div class="container-fluid"> 
      <div class="row" > 
        <div class="col-sm-4">
            <span style="font-size: 22px;">Product Category</span> 
            <span style="font-size: 16px;">- Manage Product Categories</span> 
        </div>
      </div>
    </div>
    <div style="background-color: darkgray;"  class="container-fluid"> 
        <div class="row"> 
              <div  class="col-sm-3 offset-sm-1"><SELECT id='selCatProducts' ></SELECT></div> 
        </div>
        <div class="row"> 
          <div   class="col-sm-1"><SELECT size="5" id='selCatAll' ></SELECT></div>
          <div class="col-sm-1">
              <div class="row"> 
                  <div class="col-sm-1">
                  <INPUT id='btnHomeAdd' type=button value='>>' />
                  </div>
              </div> 
              <div class="row">
                  <div class="col-sm-1">
                  <INPUT id='btnHomeAdd' type=button value='<<' />
                  </div>
              </div>
          </div>
          <div class="col-sm-1"><SELECT size="5" id='selCatSelected' ></SELECT></div>
        </div>  
      </div>
  </div>

  </div>
  
<footer>
		<div class="container">
			<span class="left">
				<a id="hlink1" runat="server" Text="" href="~/ContactUS.aspx"></a> 
				</span> <span class="right"><a href="http://www.schuebelsoftware.com" alt="Schuebel Software Solutions"><span style="font-size:small;">&copy 2010 Schuebel Software Solutions</span></a></span>
		  </div>
</footer>


<script>

    var SSS = SSS || {};
    SSS.Purchase = {};
    SSS.Product = {};
    SSS.Category = {};
    

    /*****************************************  Product Class ***********************/
    (function() {
      let self = this;
      self.mProducts = [];

      this.Add = function(newProduct) {
        self.mProducts.push(newProduct);
      };

      this.Remove = function(newProduct) {
        self.mProducts.push(newProduct);
      };
      
      this.Products = function() {
        return self.mProducts;
      };

      this.GetProductByID = function(ProductID) {
        var res = self.mProducts.find(element => {
          if (element.ProductID==ProductID) return element;
        });
        return res;
      };

      this.Save = function() {
        return self.mProducts;
      };

      this.Load = function() {
        return new Promise((resolve, reject) => {
          $.getJSON("api/products?brk=" + (new Date()).getTime(), null, function (data) {
            console.log('product load', data);
            resolve(data.data);
          })
          .fail(function(jqXHR, textStatus, errorThrown) { alert('getJSON request failed! ' + textStatus); reject(textStatus)})
        });
      };

      this.init = function init(){
        self.Load().then(data => {
          console.log('product init after promis data', data);
          self.mProducts = data;
              //******** Testing
              self.Add({ ProductID: 3, Title: "Water3", Count: 1, Cost: 3.00});
              RefreshProductRows();
            // setTimeout(() => {
            SSS.Purchase.init();
            // }, 500); 
        })
        .catch(error => {
          console.log(error);
        });
      }
    }).apply(SSS.Product);

    /*****************************************  Purchase Class ***********************/
    (function() {
      let self = this;
      self.mPurchases = [];

      this.Add = function(newPurchase) {
        //console.log('Purchase Add');

        var prod =  SSS.Product.GetProductByID(newPurchase.ProductID);
        //console.log('Purchase Add GetProductByID', prod);
        newPurchase.UnitCount = prod.Count;
        newPurchase.UnitCost = prod.Cost;
        newPurchase.Cost = new Intl.NumberFormat('en-US', { style:'currency', currency: 'USD'}).format(newPurchase.Count * prod.Cost);
        newPurchase.Title = prod.Title;
        newPurchase.PurchaseDate = new Date(newPurchase.PurchaseDate);
                
        //console.log('Purchase Add newpurchase', newPurchase);
        self.mPurchases.push(newPurchase);
      };
      

      this.Purchases = function() {
        return self.mPurchases;
      };

      this.Save = function() {
        return self.mProducts;
      };

      this.Load = function() {
        return new Promise((resolve, reject) => {
          $.getJSON("api/purchases?brk=" + (new Date()).getTime(), null, function (data) {
            console.log('purchase init', data);
            resolve(data.data);
          })
          .fail(function(jqXHR, textStatus, errorThrown) { alert('getJSON request failed! ' + textStatus); reject(textStatus)})
        });
      };

      this.init = function(){
        self.Load().then(data => {
          console.log('purchase init after promis data', data);
          $.each(data, function (key, value) {
              self.Add(value);
          });
          document.getElementById("defaultOpen").click();
         })
         .catch(error => {
          console.log(error);
        });
      }
      
    }).apply(SSS.Purchase);


    /*****************************************  mCategory Class ***********************/
    (function() {
      let self = this;
      self.mCategories = [];
      self.mCategoriesXref = [];

      this.Add = function(newPurchase) {
        self.mCategories.push(newPurchase);
      };
      

      this.Categories = function() {
        return self.mCategories;
      };

      this.GetCategoryByProductID = function(ProductID) {
        let selProductList = [];
        (self.mCategoriesXref).forEach(element => {
          if (element.ProductID==ProductID) {
            let cat =  self.mCategories.find(function(cat) {
              return cat.CategoryID==element.CategoryID;
            });
            selProductList.push(cat);
          }
        });
        return selProductList;
      };

      this.Save = function() {
        return self.mProducts;
      };

      this.LoadCategory = function() {
        return new Promise((resolve, reject) => {
          $.getJSON("api/categories?brk=" + (new Date()).getTime(), null, function (data) {
          console.log('Categories init', data);
            resolve({ type:1, data : data.data});
          })
          .fail(function(jqXHR, textStatus, errorThrown) { alert('getJSON request failed! ' + textStatus); reject(textStatus)})
        });
      };

      this.LoadCategoryXref = function() {
        return new Promise((resolve, reject) => {
          $.getJSON("api/categoryxref?brk=" + (new Date()).getTime(), null, function (data) {
            console.log('Categories categoryxref init', data);
            resolve({ type:2, data : data.data});
          })
          .fail(function(jqXHR, textStatus, errorThrown) { alert('getJSON request failed! ' + textStatus); reject(textStatus)})
        });
      };

      function init(){
        console.log("Category init");
        let promises = [];
        promises.push(self.LoadCategory());
        promises.push(self.LoadCategoryXref());
 
        Promise.all(promises).then((results) => {
          //console.log("promisall results",results);
          results.forEach((item) => {
              //console.log("promisall item",item);
              if (item.type===1){
                //console.log('Categories category init', item.data);
                self.mCategories = item.data;
              }
              if (item.type===2){
                //console.log('Categories categoryxref init', item.data);
                self.mCategoriesXref = item.data;
                RefreshCategoryRows();
            }
          });

        })
        .catch(error => {
          console.log(error);
        });
      }
      init();
    }).apply(SSS.Category);
    

    /*****************************************  Home Tab ***********************/
     $('#btnHomeAdd').click(function() {
      var selProductId = $('#selHomeProducts').val();
      var PurchaseCount = $('#txtHomeCount').val();
      if (PurchaseCount==""){
        alert("A Count of Items purchased is required");
        return;
      }
      var PurchaseDate = $('#txtHomeDate').val();
      if (PurchaseDate==""){
        alert("A Date of Items purchased is required");
        return;
      }

      PurchaseDate=new Date(PurchaseDate);
      SSS.Purchase.Add({ ProductID: selProductId, Count: PurchaseCount, PurchaseDate: PurchaseDate});
      RefreshPurchaseRows();
    });

    function RefreshPurchaseRows() {

      $("#tblPurchaseData2").find("tr:gt(0)").remove();
      

      var rows = $("#tblPurchaseData > .row");
      for (i=0; i< rows.length;i++) {
       // if (i>0)//Skip title row
          rows[i].remove();  
      }

      var vals = SSS.Purchase.Purchases();
      (vals).forEach(element => {
        var appendEl = $("<div class='row'></div>").appendTo("#tblPurchaseData");
        $("<div class='col-sm-2'>" + element.Title + "</div><div class='col-sm-2'>" + element.UnitCount + "</div><div class='col-sm-2'>" + element.UnitCost + "</div><div class='col-sm-2'>" + element.Count + "</div><div class='col-sm-2'>" + element.Cost + "</div>").appendTo(appendEl);  


        //console.log('datetype', typeof(element.PurchaseDate));
        var appendEl2 = $("<tr></tr>").appendTo("#tblPurchaseData2");
        $("<td>" + element.Title + "</td><td>" + element.UnitCount + "</td><td>" + element.UnitCost + "</td><td>" + element.Count + "</td><td>" + element.Cost + "</td><td>" + element.PurchaseDate.toDateString() + "</td>").appendTo(appendEl2);  
        


      });
      

    }

    /*****************************************  Product Tab ***********************/
    $('#btnAddProduct').click(function() {
      var ProductTitle = $('#txtAddTitle').val();
      var ProductCount = $('#txtAddCount').val();
      var ProductCost = $('#txtAddCost').val();

      if (ProductTitle==""){
        alert("An Item Title is required");
        return;
      }

      if (ProductCount==""){
        alert("An Item Count is required");
        return;
      }
      if (ProductCost==""){
        alert("An Item Cost is required");
        return;
      }

      var Prods = SSS.Product.Products();
      var Idx = Prods.length + 1;
      SSS.Product.Add({ ProductID: Idx, Title: ProductTitle, Count: ProductCount, Cost: ProductCost});
      SSS.Product.Save();
      RefreshProductRows();
      $('#txtAddTitle').val('');
      $('#txtAddCount').val('');
      $('#txtAddCost').val('');
    });

    $('#btnRemoveProduct').click(function() {
//      var ans = confirm("Are you sure you want to delete (" + $('#selProducts').text() + ")");
//      if (ans===true){
//          alert("deleting item id=" + $('#selProducts').val());
      //TODO  SSS.Product.Remove();
    });

    function RefreshProductRows() {

      //******** Refresh Home select      
      $("#selHomeProducts").empty();
      var vals = SSS.Product.Products();
      (vals).forEach(element => {
        var txt = element.Title + ".........." + element.Count + ".........." + element.Cost;
        $("#selHomeProducts").append(new Option(txt, element.ProductID));
      });

      //******** Refresh Category select      
      $("#selCatProducts").empty();
      $("#selCatProducts").append(new Option("Select Product", "-1"));
      var vals = SSS.Product.Products();
      (vals).forEach(element => {
        $("#selCatProducts").append(new Option(element.Title, element.ProductID));
      });
      

      //******** Refresh Product grid
      var rows = $("#tblProductData > .row");
      for (i=0; i< rows.length;i++) {
          rows[i].remove();  
      }

      (vals).forEach(element => {
        var appendEl = $("<div class='row'></div>").appendTo("#tblProductData");
        $("<div class='col-sm-2'>" + element.ProductID + "</div><div class='col-sm-2'>" + element.Title + "</div><div class='col-sm-2'>" + element.Count + "</div><div class='col-sm-2'>" + element.Cost + "</div>").appendTo(appendEl);  
      });
    }

    /*****************************************  Category Tab ***********************/
    $('#btnAddCategory').click(function() {
      var AddCategoryTitle = $('#txtAddCategoryTitle').val();
      if (AddCategoryTitle==""){
        alert("Category Title is required");
        return;
      }

      $('#btnDelCategory').prop('disabled', false);
    });
    $('#btnDelCategory').click(function() {
      alert("Category delete");
    });
    $('#btnUpdateCategory').click(function() {
      alert("Category update");
    });

    function RefreshCategoryRows() {
      //******** Refresh Home select      
      $("#selCatAll").empty();
      var vals = SSS.Category.Categories();
      (vals).forEach(element => {
        $("#selCatAll").append(new Option(element.Title, element.CategoryID));
      });

      $("#tblCategoryData").find("tr:gt(0)").remove();
      (vals).forEach(element => {
        //console.log('tblCategoryData element', element);
        var appendEl2 = $("<tr></tr>").appendTo("#tblCategoryData");
        $("<td>" + element.CategoryID + "</td><td>" + element.Title + "</td>").appendTo(appendEl2);  
        
      });
    }

    /*****************************************  Product Category Tab ***********************/
    $('#selCatProducts').change(function() {
      var selProductId = $('#selCatProducts').val();
      if (selProductId=="-1") return;

      $("#selCatAll").empty();
      $("#selCatSelected").empty();
      
      let all = SSS.Category.Categories();
      let selected = SSS.Category.GetCategoryByProductID(selProductId);
      (all).forEach(element => {
        let cat =  selected.find(function(cat) {
              return cat.CategoryID==element.CategoryID;
            });
        if (cat==null)
          $("#selCatAll").append(new Option(element.Title, element.CategoryID));
      });

      (selected).forEach(element => {
        $("#selCatSelected").append(new Option(element.Title, element.CategoryID));
      });


    });


    /*****************************************  Tabs ***********************/
    function openTab(evt, tabName) {
      console.log("Calling OPENTAB tabName", tabName);
      var i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }

      if (tabName==null) return;
      document.getElementById(tabName).style.display = "block";
      evt.currentTarget.className += " active";

      switch(tabName) {
        case "Home":
        RefreshPurchaseRows();
        break;
        case "Product":
          RefreshProductRows();
        break;
      }
    }

    //Jquery IIFE
    //$(document).ready(function(){    });


    (function() {
      //console.log("IIFE");
      $("#tblCategoryData > tr").click(function(){
        alert("Click!");
      });

      SSS.Product.init();
      
    // Get the element with id="defaultOpen" and click on it
    //document.getElementById("defaultOpen").click();
    })();
</script>
   
</body>
</html> 
