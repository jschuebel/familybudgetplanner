<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<!--
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<link rel="stylesheet" href="bootstrap/dist/css/bootstrap.min.css" />
<script src="bootstrap/dist/js/bootstrap.min.js"></script>

<style>
* {box-sizing: border-box}


body {font-family: "Lato", sans-serif;
  /*  background-color: #e2e2e2; */
	}

.monoselect {
    font-family: monospace,monospace;
}


/* Style the tab */
.tab {
  float: left;
  border: 1px solid #ccc;
  background-color: #f1f1f1;
  width: 10%;
  height: 600px;

    
}

/* Style the buttons inside the tab */
.tab button {
  display: block;
  background-color: inherit;
  color: black;
  padding: 22px 16px;
  width: 100%;
  border: none;
  outline: none;
  text-align: left;
  cursor: pointer;
  transition: 0.3s;
  font-size: 17px;
}

/* Change background color of buttons on hover */
.tab button:hover {
  background-color: #ddd;
}

/* Create an active/current "tab button" class */
.tab button.active {
  background-color: #ccc;
}

/* Style the tab content */
.tabcontent {
  float: left;
  padding: 12px 12px;
  border: 1px solid #ccc;
  width: 90%;
  border-left: none;
  height: 600px;
  /*background-color:rgb(99, 96, 99);*/
}

header {

  border: transparent 1px solid;
	background: #1e5799; /* Old browsers */
  background: -moz-linear-gradient(top,  #1e5799 0%, #207cca 30%, #2989d8 50%, #7db9e8 100%); /* FF3.6+ */
  background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#1e5799), color-stop(30%,#207cca), color-stop(50%,#2989d8), color-stop(100%,#7db9e8)); /* Chrome,Safari4+ */
  background: -webkit-linear-gradient(top,  #384049 0%,#207cca 30%,#2989d8 50%,#7db9e8 100%); /* Chrome10+,Safari5.1+ */
  background: -o-linear-gradient(top,  #1e5799 0%,#207cca 30%,#2989d8 50%,#7db9e8 100%); /* Opera 11.10+ */
  background: -ms-linear-gradient(top,  #1e5799 0%,#207cca 30%,#2989d8 50%,#7db9e8 100%); /* IE10+ */
  background: linear-gradient(to bottom,  #1e5799 0%,#207cca 30%,#2989d8 50%,#7db9e8 100%); /* W3C */
  filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#1e5799', endColorstr='#7db9e8',GradientType=0 ); /* IE6-9 */
}
</style>
</head>
<body>
	<header>
		<p class="site-title"><IMG alt="Contact Us"  style="height:100px" src="images/logo.png"></p>
		<p>Click on the buttons inside the tabbed menu:</p>
  </header>
  
	<div id="body">
		<div class="tab">
		<button class="tablinks" onclick="openTab(event, 'Home')" id="defaultOpen">Home</button>
		<button class="tablinks" onclick="openTab(event, 'Product')">Product</button>
		<button class="tablinks" onclick="openTab(event, 'Category')">Category</button>
		</div>

		<div id="Home" class="tabcontent">


        <div style="background-color: yellow;"  class="container-fluid"> 
            <div class="row"> 
                <div class="col-sm-3 offset-sm-1"><label class='monoselect'>Title........Count.........Cost</label></div> 
            </div>
            <div class="row"> 
                <div class="col-sm-1"><label class="label" >Product</label></div> 
                <div class="col-sm-3"><SELECT class='monoselect' id='selHomeProducts' name='selProcuts' ></SELECT></div> 
            </div>
            <div class="row"> 
              <div class="col-sm-1"><label class="label" ># Bought</label></div> 
              <div class="col-sm-2"><input id='txtHomeCount' type="text" class="form-control" /></div>
          </div>  
          <div class="row"> 
            <div class="col-sm-1"><label class="label" >Date of Purchase</label></div> 
            <div class="col-sm-2"><input id='txtHomeDate' type="date" class="form-control" /></div>
        </div>  
        <div class="row"> 
          <div class="col-sm-2"></div> 
      </div>  
      <div class="row"> 
                <div class="col-sm-12 offset-sm-2"><INPUT id='btnHomeAdd' type=button value='Add Purchase' /></div> 
            </div>  
        </div>

        <table id="tblPurchaseData2" class="table table-responsive table-striped table-hover table-condensed">
          <tr  style="background-color: orangered;">
              <th>Title</th>
              <th>Unit Count</th>
              <th>Unit Cost</th>
              <th>Count</th>
              <th>Cost</th>
              <th>Date</th>
            </tr>
        </table>
  

        <div  style="background-color: orangered;"  class="container-fluid"> 
            <div class="row"> 
                <div class="col-sm-12 offset-sm-2">Maintain Purchases</div> 
            </div>  
            <div class="row"> 
                <div class="col-sm-2">Title</div> 
                <div class="col-sm-2">Unit Count</div> 
                <div class="col-sm-2">Unit Cost</div> 
                <div class="col-sm-2">Count</div> 
                <div class="col-sm-2">Cost</div> 
            </div>
        </div>
        <div id="tblPurchaseData" style="background-color: white;"  class="container-fluid"> 
         </div>

  	</div>

		<div id="Product" class="tabcontent">
        <div  style="background-color: lightgreen;"  class="container-fluid"> 
            <div class="row"> 
                <div class="col-sm-2">Title</div> 
                <div class="col-sm-2"><INPUT id='txtAddTitle' name='txtAddTitle' /></div> 
            </div>
            <div class="row"> 
                <div class="col-sm-2">Count</div> 
                <div class="col-sm-2"><INPUT id='txtAddCount' name='txtAddCount' /></div> 
            </div>
            <div class="row"> 
                <div class="col-sm-2">Cost</div> 
                <div class="col-sm-2"><INPUT id='txtAddCost' name='txtAddCost' /></div> 
            </div>
            <div class="row"> 
                <div class="col-sm-3"><INPUT id='btnAddProduct' type=button value='Add' /></div> 
            </div>
        </div>
        <div  style="background-color: orangered;"  class="container-fluid"> 
            <div class="row"> 
                <div class="col-sm-12 offset-sm-3">Maintain Products</div> 
            </div>  
            <div class="row"> 
                <div class="col-sm-2">ID</div> 
                <div class="col-sm-2">Title</div> 
                <div class="col-sm-2">Count</div> 
                <div class="col-sm-2">Cost</div> 
            </div>
        </div>
        <div id="tblProductData" style="background-color: white"  class="container-fluid"> 
        </div>            
        <div  style="background-color: orangered;"  class="container-fluid"> 
            <div class="row"> 
            <div class="col-sm-3"><INPUT id='btnRemoveProduct' type=button value='Del' /></div> 
          </div>
        </div>
</div>

		<div id="Category" class="tabcontent">
		<h3>Category</h3>
		<p>Category is the capital of Japan.</p>
		</div>
</div>
<footer>
		<div class="container">
			<span class="left">
				<a id="hlink1" runat="server" Text="" href="~/ContactUS.aspx"></a> 
				</span> <span class="right"><a href="http://www.schuebelsoftware.com" alt="Schuebel Software Solutions"><span style="font-size:small;">&copy 2010 Schuebel Software Solutions</span></a></span>
		  </div>
</footer>


<script>

    var SSS = SSS || {};
    SSS.Purchase = {};
    SSS.Product = {};
    

    /*****************************************  Product Class ***********************/
    (function() {
      let self = this;
      self.mProducts = [];

      this.Add = function(newProduct) {
        self.mProducts.push(newProduct);
      };

      this.Remove = function(newProduct) {
        self.mProducts.push(newProduct);
      };
      
      this.Products = function() {
        return self.mProducts;
      };

      this.GetProductByID = function(ProductID) {
        var res = self.mProducts.find(element => {
          if (element.ProductID==ProductID) return element;
        });
        return res;
      };

      this.init = function init(){
        $.getJSON("api/products?brk=" + (new Date()).getTime(), null, function (data) {
          console.log('product init', data);
          self.mProducts = data.data;
            //******** Testing
            self.Add({ ProductID: 3, Title: "Water3", Count: 1, Cost: 3.00});
            RefreshProductRows();
           // setTimeout(() => {
           SSS.Purchase.init();
           // }, 500); 

         });
      }
    }).apply(SSS.Product);

    /*****************************************  Purchase Class ***********************/
    (function() {
      let self = this;
      self.mPurchases = [];

      this.Add = function(newPurchase) {

        var prod =  SSS.Product.GetProductByID(newPurchase.ProductID);
        console.log('GetProductByID', prod);
        newPurchase.UnitCount = prod.Count;
        newPurchase.UnitCost = prod.Cost;
        newPurchase.Cost = new Intl.NumberFormat('en-US', { style:'currency', currency: 'USD'}).format(newPurchase.Count * prod.Cost);
        newPurchase.Title = prod.Title;
        newPurchase.PurchaseDate = new Date(newPurchase.PurchaseDate);
                
        console.log('newpurchase', newPurchase);
        self.mPurchases.push(newPurchase);
      };
      

      this.Purchases = function(newPurchase) {
        return self.mPurchases;
      };

      this.init = function(){
        $.getJSON("api/purchases?brk=" + (new Date()).getTime(), null, function (data) {
          console.log('purchase init', data);
//          mPurchases = data.data;
            $.each(data.data, function (key, value) {
                self.Add(value);
/*              
                if (value.id == 1) value.Address1 = "Select/New Address";
                $('#cboAddress').append(
                    $("<option></option>")
                      .attr("value", value.id)
                      .text(value.Address1)
                );
*/                
                
            });
            
 //         RefreshPurchaseRows();
            document.getElementById("defaultOpen").click();
         });
      }
      
    }).apply(SSS.Purchase);


    

    /*****************************************  Home Tab ***********************/
     $('#btnHomeAdd').click(function() {
      var selProductId = $('#selHomeProducts').val();
      var PurchaseCount = $('#txtHomeCount').val();
      if (PurchaseCount==""){
        alert("A Count of Items purchased is required");
        return;
      }
      var PurchaseDate = $('#txtHomeDate').val();
      if (PurchaseDate==""){
        alert("A Date of Items purchased is required");
        return;
      }

      PurchaseDate=new Date(PurchaseDate);
      SSS.Purchase.Add({ ProductID: selProductId, Count: PurchaseCount, PurchaseDate: PurchaseDate});
      RefreshPurchaseRows();
    });

    function RefreshPurchaseRows() {

      $("#tblPurchaseData2").find("tr:gt(0)").remove();
      

      var rows = $("#tblPurchaseData > .row");
      for (i=0; i< rows.length;i++) {
       // if (i>0)//Skip title row
          rows[i].remove();  
      }

      var vals = SSS.Purchase.Purchases();
      (vals).forEach(element => {
        var appendEl = $("<div class='row'></div>").appendTo("#tblPurchaseData");
        $("<div class='col-sm-2'>" + element.Title + "</div><div class='col-sm-2'>" + element.UnitCount + "</div><div class='col-sm-2'>" + element.UnitCost + "</div><div class='col-sm-2'>" + element.Count + "</div><div class='col-sm-2'>" + element.Cost + "</div>").appendTo(appendEl);  


        //console.log('datetype', typeof(element.PurchaseDate));
        var appendEl2 = $("<tr></tr>").appendTo("#tblPurchaseData2");
        $("<td>" + element.Title + "</td><td>" + element.UnitCount + "</td><td>" + element.UnitCost + "</td><td>" + element.Count + "</td><td>" + element.Cost + "</td><td>" + element.PurchaseDate.toDateString() + "</td>").appendTo(appendEl2);  
        


      });
      

    }

    /*****************************************  Product Tab ***********************/
    $('#btnAddProduct').click(function() {
      var ProductTitle = $('#txtAddTitle').val();
      var ProductCount = $('#txtAddCount').val();
      var ProductCost = $('#txtAddCost').val();

      if (ProductTitle==""){
        alert("An Item Title is required");
        return;
      }

      if (ProductCount==""){
        alert("An Item Count is required");
        return;
      }
      if (ProductCost==""){
        alert("An Item Cost is required");
        return;
      }

      var Prods = SSS.Product.Products();
      var Idx = Prods.length + 1;
      SSS.Product.Add({ ProductID: Idx, Title: ProductTitle, Count: ProductCount, Cost: ProductCost});
      RefreshProductRows();
      $('#txtAddTitle').val('');
      $('#txtAddCount').val('');
      $('#txtAddCost').val('');
    });

    $('#btnRemoveProduct').click(function() {
//      var ans = confirm("Are you sure you want to delete (" + $('#selProducts').text() + ")");
//      if (ans===true){
//          alert("deleting item id=" + $('#selProducts').val());
      //TODO  SSS.Product.Remove();
    });

    function RefreshProductRows() {

      //******** Refresh Home select      
      $("#selHomeProducts").empty();
      var vals = SSS.Product.Products();
      (vals).forEach(element => {
        var txt = element.Title + ".........." + element.Count + ".........." + element.Cost;
        $("#selHomeProducts").append(new Option(txt, element.ProductID));
      });

      //******** Refresh Product grid
      var rows = $("#tblProductData > .row");
      for (i=0; i< rows.length;i++) {
          rows[i].remove();  
      }

      (vals).forEach(element => {
        var appendEl = $("<div class='row'></div>").appendTo("#tblProductData");
        $("<div class='col-sm-2'>" + element.ProductID + "</div><div class='col-sm-2'>" + element.Title + "</div><div class='col-sm-2'>" + element.Count + "</div><div class='col-sm-2'>" + element.Cost + "</div>").appendTo(appendEl);  
      });


    }

    /*****************************************  Tabs ***********************/
    function openTab(evt, tabName) {
      console.log("Calling OPENTAB");
      var i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }

      if (tabName==null) return;
      document.getElementById(tabName).style.display = "block";
      evt.currentTarget.className += " active";

      console.log("cityname", tabName);
      switch(tabName) {
        case "Home":
        RefreshPurchaseRows();
        break;
        case "Product":
          RefreshProductRows();
        break;
      }
    }

    (function() {
    console.log("IIFE");
      SSS.Product.init();
      
    // Get the element with id="defaultOpen" and click on it
    //document.getElementById("defaultOpen").click();
    })();
</script>
   
</body>
</html> 
